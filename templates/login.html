<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ | Casino Royal</title>
    <meta name="description" content="–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Casino Royal, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤">
    <meta name="theme-color" content="#0f172a">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
</head>
<body>
    <div class="auth-container">
        <div class="auth-header">
            <div class="auth-logo">üé∞</div>
            <h1 class="auth-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
            <p class="auth-subtitle">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</p>
        </div>

        <div class="auth-body">
            <div class="alert alert-error" id="errorMessage"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="username" name="username" class="form-control" required autocomplete="username">
                    <div class="form-error" id="usernameError"></div>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" name="password" class="form-control" required autocomplete="current-password">
                    <div class="form-error" id="passwordError"></div>
                </div>

                <button type="submit" class="auth-btn">–í–æ–π—Ç–∏</button>

                <div class="auth-divider">
                    <span>–∏–ª–∏</span>
                </div>

                <div class="auth-footer">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="{{ url_for('signin') }}" class="auth-link">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('loginForm');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const errorMessage = document.getElementById('errorMessage');

            // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –ø–æ–ª–µ
            const inputs = [usernameInput, passwordInput];
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    const errorElement = document.getElementById(input.id + 'Error');
                    if (errorElement) errorElement.style.display = 'none';
                    errorMessage.style.display = 'none';
                });
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
                document.querySelectorAll('.form-error').forEach(el => {
                    el.style.display = 'none';
                });
                errorMessage.style.display = 'none';

                // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π
                const username = usernameInput.value.trim();
                const password = passwordInput.value;

                let isValid = true;

                // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (username.length === 0) {
                    showError('usernameError', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    isValid = false;
                }

                // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
                if (password.length === 0) {
                    showError('passwordError', '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                    isValid = false;
                }

                if (isValid) {
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
                    const submitButton = form.querySelector('button[type="submit"]');
                    submitButton.disabled = true;
                    submitButton.textContent = '–í—Ö–æ–¥–∏–º...';

                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    fetch('/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: username,
                            password: password
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                            window.location.href = data.redirect || '/';
                        } else {
                            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                            submitButton.disabled = false;
                            submitButton.textContent = '–í–æ–π—Ç–∏';

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                            errorMessage.textContent = data.message || '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                            errorMessage.style.display = 'block';
                            errorMessage.classList.add('shake');
                            setTimeout(() => {
                                errorMessage.classList.remove('shake');
                            }, 600);
                        }
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞:', error);

                        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                        submitButton.disabled = false;
                        submitButton.textContent = '–í–æ–π—Ç–∏';

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                        errorMessage.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                        errorMessage.style.display = 'block';
                    });
                }
            });

            function showError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                errorElement.textContent = message;
                errorElement.style.display = 'block';

                // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Å—Ç—Ä—è—Å–∫–∏
                const inputElement = document.getElementById(elementId.replace('Error', ''));
                inputElement.classList.add('shake');
                setTimeout(() => {
                    inputElement.classList.remove('shake');
                }, 600);
            }
        });
    </script>
</body>
</html>